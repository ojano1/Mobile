<%* await tp.user.habits_today({ folder: "03 SaveBox/Active", newestFirst: true }) %>

### ‚úçÔ∏èMy Notes
'
'testing
test

[[üîÅHabit - subuh]]
'
'
___
### üìåMy tasks for today

```dataviewjs
const ROOT = "03 SaveBox/Active";

// --- get "today" from the host filename ---
const hostName = dv.current().file.name;
// supports "07 Oct 2025" or "Tue, 07 Oct 2025"
const m = hostName.match(/(\d{1,2})\s*(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Sept|Oct|Nov|Dec|January|February|March|April|June|July|August|September|October|November|December)\s*(\d{4})/i);
if (!m) { dv.paragraph("‚ùå Host filename needs a date like `07 Oct 2025`."); return; }
const mm = {jan:"01",feb:"02",mar:"03",apr:"04",may:"05",jun:"06",jul:"07",aug:"08",sep:"09",oct:"10",nov:"11",dec:"12"}[m[2].toLowerCase().slice(0,3)];
const day = String(parseInt(m[1],10)).padStart(2,"0");
const todayISO = `${m[3]}-${mm}-${day}`;
// --- end host date ---

const pages = dv.pages(`"${ROOT}"`);

function priorityLabel(p) {
  if (!p) return "";
  const val = String(p).toLowerCase();
  if (val.startsWith("h")) return "High";
  if (val.startsWith("m")) return "Med";
  if (val.startsWith("l")) return "Low";
  return "";
}

let listItems = [];

// Tasks with due today (from host filename)
for (const p of pages) {
  const tasks = p.file?.tasks ?? [];
  for (const t of tasks) {
    const d = t.due ? t.due.toISODate() : null;
    if (!t.completed && d === todayISO) {
      const line = dv.el("div", "", { cls: "dv-today-task" });

      // checkbox + text
      const container = line.createSpan();
      container.appendChild(dv.taskList([t], false));

      // meta info
      const meta = [];
      if (p.duration_hours) meta.push(`${p.duration_hours}h`);
      if (p.priority) meta.push(priorityLabel(p.priority));
      if (meta.length) line.createSpan({ text: "  ¬∑  " + meta.join(" ¬∑ ") });

      listItems.push(line);
    }
  }
}

// Notes with frontmatter due (same comparison to host date)
for (const p of pages) {
  const fm = p.file?.frontmatter ?? {};
  const fmDueISO = fm.due ? dv.date(fm.due).toISODate() : null;
  const isDone = fm.done === true || fm.completed === true;
  if (fmDueISO === todayISO && !isDone) {
    const line = dv.el("div", "", { cls: "dv-today-note" });

    // checkbox
    const cb = line.createEl("input", { type: "checkbox" });
    cb.addEventListener("change", async e => {
      await toggleFrontmatterDone(p.file.path, e.target.checked);
      app.workspace.trigger("dataview:refresh-views");
    });

    line.createSpan({ text: " " });
    const a = line.createEl("a", { href: "#", text: p.file.name });
    a.addEventListener("click", evt => {
      evt.preventDefault();
      app.workspace.openLinkText(p.file.path, dv.current().file.path, false);
    });

    const meta = [];
    if (p.duration_hours) meta.push(`${p.duration_hours}h`);
    if (p.priority) meta.push(priorityLabel(p.priority));
    if (meta.length) line.createSpan({ text: "  ¬∑  " + meta.join(" ¬∑ ") });

    listItems.push(line);
  }
}

// toggle YAML done (unchanged)
async function toggleFrontmatterDone(filePath, value) {
  const file = app.vault.getAbstractFileByPath(filePath);
  if (!file) return;
  const content = await app.vault.read(file);
  const m = content.match(/^---\n([\s\S]*?)\n---\n?([\s\S]*)$/);
  if (m) {
    let fm = m[1];
    if (/^done:/m.test(fm)) {
      fm = fm.replace(/^done:\s*(true|false).*$/m, `done: ${value}`);
    } else if (/^completed:/m.test(fm)) {
      fm = fm.replace(/^completed:\s*(true|false).*$/m, `completed: ${value}`);
    } else {
      fm += `\ndone: ${value}`;
    }
    await app.vault.modify(file, `---\n${fm}\n---\n${m[2]}`);
  } else {
    await app.vault.modify(file, `---\ndone: ${value}\n---\n${content}`);
  }
}

if (!listItems.length) {
  dv.paragraph("‚úÖ All done! üëè‚òïÔ∏è");
} else {
  for (const item of listItems) dv.container.appendChild(item);
}
```

### üîÅ My Habits for today

~~~dataviewjs
const ROOT = "03 SaveBox/Active";
const HABIT_PREFIX = "üîÅHabit - ";

// --- get "today" from the host filename (same pattern as your tasks block) ---
const hostName = dv.current().file.name;
// supports "07 Oct 2025" or "Tue, 07 Oct 2025"
const m = hostName.match(/(\d{1,2})\s*(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Sept|Oct|Nov|Dec|January|February|March|April|May|June|July|August|September|October|November|December)\s*(\d{4})/i);

let todayISO = null;
if (m) {
  const mm = {jan:"01",feb:"02",mar:"03",apr:"04",may:"05",jun:"06",jul:"07",aug:"08",sep:"09",oct:"10",nov:"11",dec:"12"}[m[2].toLowerCase().slice(0,3)];
  const day = String(parseInt(m[1],10)).padStart(2,"0");
  todayISO = `${m[3]}-${mm}-${day}`;
}

// --- guard: if filename has no date, show hint (no return) ---
if (!todayISO) {
  dv.paragraph("‚ùå Host filename needs a date like `07 Oct 2025`.");
} else {
  // all habit files under ROOT
  const pages = dv.pages(`"${ROOT}"`)
    .where(p => p.file?.name?.startsWith(HABIT_PREFIX))
    .sort(p => p.file.name.toLowerCase());

  if (!pages.length) {
    dv.paragraph("_No habit files found in `03 SaveBox/Active/`_");
  } else {
    for (const p of pages) {
      const tasks = p.file?.tasks ?? [];
      // each habit keeps a daily line: "- [ ] YYYY-MM-DD ^YYYY-MM-DD"
      const t = tasks.find(x => (x.text ?? "").trim() === todayISO);

      const row = dv.el("div", "", { cls: "dv-habit-line" });
      const label = p.file.name.replace(HABIT_PREFIX, "");
      row.createSpan({ text: `**${label}** ‚Üí ` });

      if (t) {
        const holder = row.createSpan();
        holder.appendChild(dv.taskList([t], false)); // live checkbox
      } else {
        row.createSpan({ text: "(missing today entry)" });
      }
    }
  }
}
~~~




### Overdue Tasks

~~~dataviewjs
const ROOT = "03 SaveBox/Active";

// --- get "today" (host date) from the host filename ---
const hostName = dv.current().file.name;
// supports "07 Oct 2025" or "Tue, 07 Oct 2025"
const m = hostName.match(/(\d{1,2})\s*(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Sept|Oct|Nov|Dec|January|February|March|April|June|July|August|September|October|November|December)\s*(\d{4})/i);
if (!m) { dv.paragraph("‚ùå Host filename needs a date like `07 Oct 2025`."); return; }
const mm = {jan:"01",feb:"02",mar:"03",apr:"04",may:"05",jun:"06",jul:"07",aug:"08",sep:"09",oct:"10",nov:"11",dec:"12"}[m[2].toLowerCase().slice(0,3)];
const day = String(parseInt(m[1],10)).padStart(2,"0");
const todayISO = `${m[3]}-${mm}-${day}`;
const today = dv.date(todayISO);
// --- end host date ---

const pages = dv.pages(`"${ROOT}"`);

function priorityLabel(p) {
  if (!p) return "";
  const val = String(p).toLowerCase();
  if (val.startsWith("h")) return "High";
  if (val.startsWith("m")) return "Med";
  if (val.startsWith("l")) return "Low";
  return "";
}

// helper to calculate day difference
function daysBetween(older, newer) {
  const diff = Math.floor((newer.ts - older.ts) / (1000 * 60 * 60 * 24));
  return diff;
}

let listItems = [];

// Tasks with due before host date (overdue)
for (const p of pages) {
  const tasks = p.file?.tasks ?? [];
  for (const t of tasks) {
    const d = t.due ? t.due.toISODate() : null;
    if (!t.completed && d && d < todayISO) {
      const dueDate = dv.date(d);
      const diff = daysBetween(dueDate, today);
      const line = dv.el("div", "", { cls: "dv-overdue-task" });

      // checkbox + text
      const container = line.createSpan();
      container.appendChild(dv.taskList([t], false));

      // days due display
      const text = diff === 1 ? "1 day due" : `${diff} days due`;
      line.createSpan({ text: "  ¬∑  " + text });

      listItems.push(line);
    }
  }
}

// Notes with frontmatter due before host date
for (const p of pages) {
  const fm = p.file?.frontmatter ?? {};
  const fmDueISO = fm.due ? dv.date(fm.due).toISODate() : null;
  const isDone = fm.done === true || fm.completed === true;
  if (fmDueISO && fmDueISO < todayISO && !isDone) {
    const dueDate = dv.date(fmDueISO);
    const diff = daysBetween(dueDate, today);
    const line = dv.el("div", "", { cls: "dv-overdue-note" });

    // checkbox
    const cb = line.createEl("input", { type: "checkbox" });
    cb.addEventListener("change", async e => {
      await toggleFrontmatterDone(p.file.path, e.target.checked);
      app.workspace.trigger("dataview:refresh-views");
    });

    line.createSpan({ text: " " });
    const a = line.createEl("a", { href: "#", text: p.file.name });
    a.addEventListener("click", evt => {
      evt.preventDefault();
      app.workspace.openLinkText(p.file.path, dv.current().file.path, false);
    });

    // days due display
    const text = diff === 1 ? "1 day due" : `${diff} days due`;
    line.createSpan({ text: "  ¬∑  " + text });

    listItems.push(line);
  }
}

// toggle YAML done (unchanged)
async function toggleFrontmatterDone(filePath, value) {
  const file = app.vault.getAbstractFileByPath(filePath);
  if (!file) return;
  const content = await app.vault.read(file);
  const m = content.match(/^---\n([\s\S]*?)\n---\n?([\s\S]*)$/);
  if (m) {
    let fm = m[1];
    if (/^done:/m.test(fm)) {
      fm = fm.replace(/^done:\s*(true|false).*$/m, `done: ${value}`);
    } else if (/^completed:/m.test(fm)) {
      fm = fm.replace(/^completed:\s*(true|false).*$/m, `completed: ${value}`);
    } else {
      fm += `\ndone: ${value}`;
    }
    await app.vault.modify(file, `---\n${fm}\n---\n${m[2]}`);
  } else {
    await app.vault.modify(file, `---\ndone: ${value}\n---\n${content}`);
  }
}

if (!listItems.length) {
  dv.paragraph("‚úÖ All done! üëè");
} else {
  for (const item of listItems) dv.container.appendChild(item);
}
~~~
___
#### üë®‚ÄçüíªMy Daily Timeslots (6hrs)
Type your task links below these timeslots to plan your day.
##### üåÖMorning (3.5hrs, 9.00-11.30AM)
*High-impact task*

##### ‚òÄÔ∏èAfternoon (1.5hrs, 2.00-3.30PM)
*Key delivery/admin task*

##### üåôNight (1hr, 9.00-10.00PM)
*Habit / reflection*

---
#### üîÑ End-of-Day Review
- Check off tasks honestly.  
- Review today‚Äôs captures in **Inbox dashboard**.  
- Promote worthwhile items ‚Üí rename to remove `!`.  
- One insight / lesson: ‚Ä¶  

---

### üì´Inbox
(Remove suffix ! to release from inbox)
~~~dataview
TABLE
  dateformat(file.ctime, "yyyy-MM-dd") AS Created,
  gap + " " + choice(gap = 1, "day", "days") AS Age
FROM "03 SaveBox/Active"
WHERE endswith(file.name, "!")
FLATTEN floor((
  date(dateformat(date(now), "yyyy-MM-dd"))
  - date(dateformat(file.ctime, "yyyy-MM-dd"))
).milliseconds / 86400000) AS gap
SORT file.ctime ASC

~~~
### üîóBacklinks
~~~dataviewjs
const backlinks = dv.pages()
  .where(p =>
    p.file.outlinks &&
    p.file.outlinks.some(link => link.path === dv.current().file.path) &&
    !/template/i.test(p.file.folder) &&
    !/archive/i.test(p.file.folder)
  )
  .sort(p => p.file.name, 'asc');

if (backlinks.length) {
  dv.list(backlinks.map(p => p.file.link));
} else {
  dv.paragraph("None");
}
~~~


